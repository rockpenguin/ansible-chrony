{{ ansible_managed | comment }}

# This the default chrony.conf file for the Debian chrony package.  After
# editing this file use the command 'invoke-rc.d chrony restart' to make
# your changes take effect.  John Hasler <jhasler@debian.org> 1998-2008

# See www.pool.ntp.org for an explanation of these servers.  Please
# consider joining the project if possible.  If you can't or don't want to
# use these servers I suggest that you try your ISP's nameservers.  We mark
# the servers 'offline' so that chronyd won't try to connect when the link
# is down.  Scripts in /etc/ppp/ip-up.d and /etc/ppp/ip-down.d use chronyc
# commands to switch it on when a dialup link comes up and off when it goes
# down.  Code in /etc/init.d/chrony attempts to determine whether or not
# the link is up at boot time and set the online status accordingly.  If
# you have an always-on connection such as cable omit the 'offline'
# directive and chronyd will default to online.
#
# Note that if Chrony tries to go "online" and dns lookup of the servers
# fails they will be discarded.  Thus under some circumstances it is
# better to use IP numbers than host names.

{% for server_line in chrony_ntp_servers %}
server {{ server_line }}
{% endfor %}

{% if chrony_server == true %}
{% for allow_net in chrony_server_allow_nets %}
allow {{ allow_net }}
{% endfor %}
{% endif %}

# Look here for the admin password needed for chronyc.  The initial
# password is generated by a random process at install time.  You may
# change it if you wish.

keyfile {{ chrony_keys_file | default('/etc/chrony/chrony.keys') }}

# This directive sets the key ID used for authenticating user commands via the
# 'chronyc' program at run time.

commandkey {{ chrony_commandkey | default('1') }}

# I moved the driftfile to /var/lib/chrony to comply with the Debian
# filesystem standard.

driftfile {{ chrony_drift_file | default('/var/lib/chrony/chrony.drift') }}

# Comment these lines out to turn off logging.

log {{ chrony_log_options | default('tracking measurements statistics') }}
logdir {{ chrony_log_dir | default('/var/log/chrony') }}

# Stop bad estimates upsetting machine clock.
maxupdateskew {{ chrony_maxupdateskew | default('100.0') }}

makestep {{ chrony_makestep | default('10 3') }}

{% if chrony_dumponexit %}
# Dump measurements when daemon exits.
dumponexit
dumpdir {{ chrony_dumpdir | default('/var/lib/chrony') }}
{% endif %}

# This directive forces `chronyd' to send a message to syslog if it
# makes a system clock adjustment larger than a threshold value in seconds.

logchange {{ chrony_logchange | default('0.5') }}

{% if chrony_rtconutc %}
rtconutc
{% else %}
# This directive tells 'chronyd' to parse the 'adjtime' file to find out if the
# real-time clock keeps local time or UTC. It overrides the 'rtconutc' directive.

hwclockfile /etc/adjtime
{% endif %}

{% if chrony_rtsync %}
# This directive enables kernel synchronisation (every 11 minutes) of the
# real-time clock. Note that it canâ€™t be used along with the 'rtcfile' directive.
rtsync
{% endif %}
